{% extends "layouts/base.njk" %}
{% from "govuk/components/details/macro.njk" import govukDetails %}

{% block beforeContent %}

{% endblock %}

{% block content %}
  <div class="govuk-grid-row">
    {% include 'partials/sub-navigation.njk' %}
    
    <div class="govuk-grid-column-three-quarters-from-desktop">
      {% include 'partials/header.njk' %}

      {% if howItWorks %}
        <section class="doc-how-it-works">
          <h2 class="govuk-heading-l">How it works</h2>
          {{ howItWorks | markdown }}
        </section>
      {% endif %}

      {% include 'partials/examples.njk' %}

      {% if contentSchema or contentType or publishingApp %}
        <section class="doc-how-its-built">
          <h2 class="doc-how-its-built__title govuk-heading-l">How it's built</h2>
          <div class="govuk-grid-row">
            {% if contentSchema %}
              <div class="govuk-grid-column-one-half">
                <h3 class="doc-how-its-built__subtitle govuk-heading-m">Content schema</h3>
                <p class="govuk-body">
                  <a href="{{ contentSchema.link }}" class="govuk-link">{{ contentSchema.title }}</a>
                </p>
                {{ govukDetails({
                  summaryText: "What is a content schema?",
                  text: "A GOV.UK content schema is a JSON schema that defines the data structure of a piece of content. It determines what content and metadata attributes the page has. It’s different from the GOV.UK document type. For example ‘publication’ is the schema for transparency data."
                }) }}
              </div>
            {% endif %}
            {% if contentType %}
              <div class="govuk-grid-column-one-half">
                <h3 class="doc-how-its-built__subtitle govuk-heading-m">Content type</h3>
                <p class="govuk-body">
                  <a href="{{contentType.link }}" class="govuk-link">{{ contentType.title }}</a>
                {{ govukDetails({
                  summaryText: "What is a content type?",
                  text: "Content type describes the types of pages that exist on GOV.UK. It’s stored in the content item (JSON) as document_type. It powers search filters in finders and changes the content type label users see on GOV.UK pages. For example ‘transparency’ is the document type for transparency data."
                }) }}
              </div>
            {% endif %}
            {% if publishingApp %}
              <div class="govuk-grid-column-one-half">
                <h3 class="doc-how-its-built__subtitle govuk-heading-m">Publishing app</h3>
                {% if publishingApp === "collections publisher" %}
                  <p class="govuk-body">
                    <a href="https://docs.publishing.service.gov.uk/repos/collections-publisher.html" class="govuk-link">collections-publisher</a>
                  </p>
                {% elif publishingApp === "contacts admin" %}
                  <p class="govuk-body">
                    <a href="https://docs.publishing.service.gov.uk/repos/contacts-admin.html" class="govuk-link">contacts-admin</a>
                  </p>
                {% elif publishingApp === "content publisher" %}
                  <p class="govuk-body">
                    <a href="https://docs.publishing.service.gov.uk/repos/content-publisher.html" class="govuk-link">content-admin</a>
                  </p>
                {% elif publishingApp === "content tagger" %}
                  <p class="govuk-body">
                    <a href="https://docs.publishing.service.gov.uk/repos/content-tagger.html" class="govuk-link">content-tagger</a>
                  </p>
                {% elif publishingApp === "local links manager" %}
                  <p class="govuk-body">
                    <a href="https://docs.publishing.service.gov.uk/repos/local-links-manager.html" class="govuk-link">local-links-manager</a>
                  </p>
                {% elif publishingApp === "mainstream publisher" %}
                  <p class="govuk-body">
                    <a href="https://docs.publishing.service.gov.uk/repos/publisher.html" class="govuk-link">mainstream-publisher</a>
                  </p>
                {% elif publishingApp === "manuals publisher" %}
                  <p class="govuk-body">
                    <a href="https://docs.publishing.service.gov.uk/repos/manuals-publisher.html" class="govuk-link">manuals-publisher</a>
                  </p>
                {% elif publishingApp === "maslow" %}
                  <p class="govuk-body">
                    <a href="https://docs.publishing.service.gov.uk/repos/maslow.html" class="govuk-link">maslow</a>
                  </p>
                {% elif publishingApp === "service manual publisher" %}
                  <p class="govuk-body">
                    <a href="https://docs.publishing.service.gov.uk/repos/service-manual-publisher.html" class="govuk-link">service-manual-publisher</a>
                  </p>
                {% elif publishingApp === "short url manager" %}
                  <p class="govuk-body">
                    <a href="https://docs.publishing.service.gov.uk/repos/short-url-manager.html" class="govuk-link">short-url-manager</a>
                  </p>
                {% elif publishingApp === "specialist publisher" %}
                  <p class="govuk-body">
                    <a href="https://docs.publishing.service.gov.uk/repos/specialist-publisher.html" class="govuk-link">specialist-publisher</a>
                  </p>
                {% elif publishingApp === "travel advice publisher" %}
                  <p class="govuk-body">
                    <a href="https://docs.publishing.service.gov.uk/repos/travel-advice-publisher.html" class="govuk-link">travel-advice-publisher</a>
                  </p>
                {% elif publishingApp === "whitehall" %}
                  <p class="govuk-body">
                    <a href="https://docs.publishing.service.gov.uk/repos/whitehall.html" class="govuk-link">whitehall</a>
                  </p>
                {% endif %}
                {{ govukDetails({
                  summaryText: "What is a publishing app?",
                  text: "A publishing app is a software application that is used to publishing and manage the content that appears on GOV.UK"
                }) }}
              </div>
            {% endif %}
          </div>
        </section>
      {% endif %}

      {% if components %}
        <section class="doc-components">
          <h2 class="govuk-heading-l">Components</h2>
          <table class="govuk-table">
            <thead class="govuk-table__head">
              <tr class="govuk-table__row">
                <th scope="col" class="govuk-table__header">Component</th>
                <th scope="col" class="govuk-table__header">Source</th>
                <th scope="col" class="govuk-table__header">Publishing app input field(s)</th>
              </tr>                     
            </thead>
            <tbody class="govuk-table__body">
              {% for i in range(0, components | length ) %}
                <tr class="govuk-table__row">
                  <th scope="row" class="govuk-table__header">
                    {% if components[i].componentURL %}  
                      <a href="{{ components[i].componentURL }}">{{ components[i].componentName }}</a>
                    {% else %}
                      {{ components[i].componentName | markdown("inline") }}
                    {% endif %}  
                  </th>
                  <td class="govuk-table__cell">
                    {% if components[i].generated === "auto" %}
                      Autogenerated in frontend template
                    {% elif components[i].generated === "publisher" %}
                      Customized by publisher
                    {% elif components[i].generated === "hardcode" %}
                      Hardcoded by developer
                    {% endif %}
                  </td>
                  <td class="govuk-table__cell">{{ components[i].input }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </section>
      {% endif %}
      
      {% include 'partials/insights.njk' %}
      {% include 'partials/improve.njk' %}
      {% include 'partials/contribute.njk' %}

      {{ appProseScope(content) if content }}

      {% include "layouts/shared/related.njk" %}
    </div>
  </div>
{% endblock %}